shadow$provide[167]=function(r,l,A,p){r=l(73);l(116);var k=l(165),m=l(166),d=l(115),c=l(108);let a=0;const b={textureCount:0,uboCount:0};class e{constructor(g){this.destroyed=!1;this.renderer=g;this.systemCheck();this.program=this.shader=this.gl=null;this.cache={};this._uboCache={};this.id=a++}systemCheck(){if(!d.unsafeEvalSupported())throw Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.");}contextChange(g){this.gl=g;this.reset()}bind(g,
f){g.disposeRunner.add(this);g.uniforms.globals=this.renderer.globalUniforms;const h=g.program,n=h.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(g);return this.shader=g,this.program!==h&&(this.program=h,this.gl.useProgram(n.program)),f||(b.textureCount=0,b.uboCount=0,this.syncUniformGroup(g.uniformGroup,b)),n}setUniforms(g){const f=this.shader.program;f.syncUniforms(f.glPrograms[this.renderer.CONTEXT_UID].uniformData,g,this.renderer)}syncUniformGroup(g,f){const h=this.getGlProgram();
g.static&&g.dirtyId===h.uniformDirtyGroups[g.id]||(h.uniformDirtyGroups[g.id]=g.dirtyId,this.syncUniforms(g,h,f))}syncUniforms(g,f,h){(g.syncUniforms[this.shader.program.id]||this.createSyncGroups(g))(f.uniformData,g.uniforms,this.renderer,h)}createSyncGroups(g){const f=this.getSignature(g,this.shader.program.uniformData,"u");return this.cache[f]||(this.cache[f]=c.generateUniformsSync(g,this.shader.program.uniformData)),g.syncUniforms[this.shader.program.id]=this.cache[f],g.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(g,
f){const h=this.getGlProgram();if(!g.static||0!==g.dirtyId||!h.uniformGroups[g.id]){g.dirtyId=0;const n=h.uniformGroups[g.id]||this.createSyncBufferGroup(g,h,f);g.buffer.update();n(h.uniformData,g.uniforms,this.renderer,b,g.buffer)}this.renderer.buffer.bindBufferBase(g.buffer,h.uniformBufferBindings[f])}createSyncBufferGroup(g,f,h){var {gl:n}=this.renderer;this.renderer.buffer.bind(g.buffer);const q=this.gl.getUniformBlockIndex(f.program,h);f.uniformBufferBindings[h]=this.shader.uniformBindCount;
n.uniformBlockBinding(f.program,q,this.shader.uniformBindCount);this.shader.uniformBindCount++;n=this.getSignature(g,this.shader.program.uniformData,"ubo");h=this._uboCache[n];if(h||(h=this._uboCache[n]=m.generateUniformBufferSync(g,this.shader.program.uniformData)),g.autoManage)n=new Float32Array(h.size/4),g.buffer.update(n);return f.uniformGroups[g.id]=h.syncFunc,f.uniformGroups[g.id]}getSignature(g,f,h){g=g.uniforms;h=[`${h}-`];for(const n in g)h.push(n),f[n]&&h.push(f[n].type);return h.join("-")}getGlProgram(){return this.shader?
this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(g){g=g.program;const f=k.generateProgram(this.gl,g);return g.glPrograms[this.renderer.CONTEXT_UID]=f,f}reset(){this.shader=this.program=null}disposeShader(g){this.shader===g&&(this.shader=null)}destroy(){this.renderer=null;this.destroyed=!0}}e.extension={type:r.ExtensionType.RendererSystem,name:"shader"};r.extensions.add(e);p.ShaderSystem=e}
goog.provide("module$node_modules$$pixi$core$lib$shader$ShaderSystem");
goog.global. module$node_modules$$pixi$core$lib$shader$ShaderSystem=shadow.js.require(167, {});
